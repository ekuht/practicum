При запуске клиент вместе с сервером генерируют каждый свою пару ключей. При подключении к серверу клиент посылает серверу ему свой открытый ключ, на что сервер посылает клиенту открытый ключ сервера. Клиент посылает сообщение серверу, шифруя его своим закрытым ключом и открытым ключом сервера. Сервер принимает сообщение, расшифровывает его сначала своим закрытым ключом, а затем - открытым ключом клиента. Далее происходит такой же процесс, но в обратную сторону. Для шифроввания будем использовать симметричное шифрование, как показано далее:

![image](https://user-images.githubusercontent.com/72302486/146648412-96c39922-19e7-4173-8a5f-bb0f48ee8eb5.png)

Далее в фукнции "get_keys()" читаются уже существующие ключи, а если таковых нет, то создаются новые.

Модифицовать код клиента и сервера нужно так, чтобы приватный и публичный ключ хранились в текстовых файлах на диске и, таким образом, переиспользовались между запусками. Далее прилагается скриншот, для того, чтобы убедиться, что  ключи в файлах не меняются:
Первым лежит файл с ключами клиента - 

![image](https://user-images.githubusercontent.com/72302486/146648505-53a09dce-56e3-46f1-9856-d3470bf0ebea.png)

Вторым же - файл с кючами сервера - 

![image](https://user-images.githubusercontent.com/72302486/146648542-de77126f-f259-42aa-b77a-4294885cbc2f.png)

Сервер хранит ключи для каждого из клиентов (по IP). Проводить рефакторинг кода клиента и сервера нужно так, чтобы все, относящееся к генерации ключей, установлению режима шифрования, шифрованию исходящих и дешифрованию входящих сообщений было отделено от основного алгоритма обмена сообщениями. Это можно увидеть в скриншотах ниже:

![image](https://user-images.githubusercontent.com/72302486/146648604-1c841544-27d1-4f78-8e25-845b9a194990.png)

![image](https://user-images.githubusercontent.com/72302486/146648636-f8c3e816-ce87-4dc1-9ef6-65b9b998998e.png)

Нужно реализовывать на сервере проверку входящих сертификатов. На сервере должен храниться список разрешенных ключей. В тот момент, когда клиент посылает на сервер свой публичный ключ, сервер ищет его среди разрешенных, а если такого нет, то разрывает соединение. Нужно проверять правильность работы на нескольких разных клиентах.

Нужно модифицировать код клиента и сервера так, чтобы установление режима шифрования происходило при подключении на один порт, а основное общение по другому порту. Номер порта можно передавать, например, как первое зашифрованное сообщение.

Модифицируйте код FTP-сервера нужно таким образом, чтобы он поддерживал шифрование. Скриншоты ниже:

![image](https://user-images.githubusercontent.com/72302486/146648811-5883a29f-42ed-4cea-9f42-d20c0df0bfa2.png)

Методы "send/recv" были заменены на собственно написанные "s_send/s_recv", которые поддерживают шифрование. Обмен ключами и генерация происходят при каждом запросе и каждый раз, соответственно, разные.
